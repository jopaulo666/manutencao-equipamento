<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" 
	xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
<meta charset="UTF-8">
<title>Cadastro de novo cliente</title>
<!--Import Google Icon Font-->
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
 
 <!-- Compiled and minified CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

<!-- Compiled and minified JavaScript -->
 <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

<!-- jQuery -->
<script src="http://code.jquery.com/jquery-3.5.1.js"></script>
<!--  jQuery Mask Plugin -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.js"></script>

<!-- Campo Data -->    
 <script src="https://unpkg.com/gijgo@1.9.13/js/gijgo.min.js" type="text/javascript"></script>
 <link href="https://unpkg.com/gijgo@1.9.13/css/gijgo.min.css" rel="stylesheet" type="text/css">

 <style type="text/css">
 	body {
	margin-left: 5%;
	margin-right: 5%;
}
 </style>
</head>
<body>

	<h5 style="text-align: center;">Novo cliente</h5>
	<br />
	<fieldset>
		<legend>Cadastro de novo cliente</legend>
	  	<div class="row" sec:authorize="hasAnyRole('ROLE_ADMIN', 'ROLE_GERENTE')">		
	
			<form class="col s12" action="salvarcliente" method="post" th:object="${clienteobj}" id="formcliente" 
				enctype="multipart/form-data">			
			
				<div th:each="m : ${msg}">
					<span th:text="${m}"> </span>
				</div>
				<br />
				
			      <div class="row">
			        <div class="input-field col s1">
					  <i class="material-icons prefix">fingerprint</i>
			          <input name="id" th:field="*{id}" readonly="readonly">
			        </div>  
			      </div>      
			      
			      <div class="row">
			        <div class="input-field col s6">
			          <i class="material-icons prefix">account_circle</i>
			          <input name="nome" id="nome" type="text" class="validate" th:field="*{nome}">
			          <label for="nome">Nome</label>
			        </div>  
			      </div>
			      
			      <div class="row">
			        <div class="input-field col s3">
			          <i class="material-icons prefix">phone</i>
			          <input name="telefone" id="telefone" type="text" class="validate" th:field="*{telefone}" onkeypress="$(this).mask('(00) 00000-0000')">
			          <label for="telefone">Telefone</label>
			        </div>
			        <div class="input-field col s3">
			          <i class="material-icons prefix">mail_outline</i>
			          <input id="email" type="email" class="validate" th:field="*{email}">
			          <label for="email">Email</label>
			        </div>
			      </div>
			      
			      <div class="row">
			        <div class="input-field col s3">
			          <i class="material-icons prefix">room</i>         
			          <input name="cep" id="cep" type="text" class="validate" th:field="*{cep}" onkeypress="$(this).mask('00000-000')">
			          <label for="cep">CEP</label>
			        </div>
			        <div class="input-field col s3">
			          <input name="bairro" id="bairro" type="text" class="validate" th:field="*{bairro}">
			          <label for="bairro">Bairro</label>
			        </div>
			      </div>
			      
			      <div class="row">
			        <div class="input-field col s5">
			          <i class="material-icons prefix">home</i>         
			          <input name="endereco" id="rua" type="text" class="validate" th:field="*{endereco}">
			          <label for="endereco">Endereço</label>
			        </div>
			        <div class="input-field col s1">
			          <input name="numero" id="numero" type="text" class="validate" th:field="*{numero}">
			          <label for="numero">N°</label>
			        </div>
			      </div>
			      
			      <div class="row">
			        <div class="input-field col s5">
			          <i class="material-icons prefix">location_city</i>         
			          <input name="cidade" id="cidade" type="text" class="validate" th:field="*{cidade}">
			          <label for="cidade">Cidade</label>
			        </div>
			        <div class="input-field col s1">
			          <input name=uf id="uf" type="text" class="validate" th:field="*{uf}">
			          <label for="uf">Estado</label>
			        </div>
			      </div>
			      
			      <div class="row">
			        <div class="input-field col s5">
			          <i class="material-icons prefix">laptop_mac</i>
			          <input name="equipamento" id="equipamento" type="text" class="validate" th:field="*{equipamento}">
			          <label for="equipamento">Equipamento (marca/modelo)</label>
			        </div>
			        <div class="input-field col s1">
<!-- 			        	<div class="file-field input-field"> -->
<!--      						<div class="btn"> -->
     							<span>Foto</span>
			          			<input name="file" id="file" type="file" class="validate" >
<!-- 		          			</div> -->
<!-- 	          			</div> -->
			        </div>  
			      </div>
			      
			      <div class="row">
			        <div class="input-field col s12">
			          <i class="material-icons prefix">build</i>
			          <input name="problema" id="problema" type="text" class="validate" th:field="*{problema}" >
			          <label for="problema">Problema</label>
			        </div>  
			      </div>
			      
			      <div class="row">
			        <div class="input-field col s3">
			          <i class="material-icons prefix">date_range</i>
			          <input name="entrada" id="entrada" type="date" placeholder="Data de entrada do equipamento" th:field="*{entrada}" required="required">
			          <label for=entrada class="active">Entrada</label>
			        </div> 
			        
			        <div class="input-field col s3">
			          <i class="material-icons prefix">date_range</i>
			          <input name="saida" id="saida" type="date" placeholder="Data de saida do equipamento" th:field="*{saida}" >
			          <label for=saida class="active">Saída</label>
			        </div>
			        
			        <div class="input-field col s3">
				        <label for="situacao" class="active">Situação</label>
						  <select class="browser-default" th:field="*{situacao}" id="situacao">
						  	<option th:each="s : ${T(br.com.jopaulo.controle.equipamento.model.Situacao).values()}"
						  		 th:value="${s.valor}" th:text="${s.nome}">
					  		 </option>
						  </select>
					 </div>
			      </div>
			
					<button class="btn waves-effect waves-light" type="submit"	name="action">Salvar 
						<i class="material-icons right">save</i>
					</button>
					
					<button class="btn waves-effect waves-light" type="reset" onclick="document.getElmentById('formcliente').reset();">	Limpar
						<i class="material-icons right">clear</i>
					</button>
					<br> <br>
			</form>    
	  	</div>
  	</fieldset>
	<br>
	
	<fieldset>
		<legend>Campo de pesquisa</legend>
		<div class="row">
			<form class="col s12" method="post" action="pesquisarcliente" id="pesquisarcliente">			
				<div class="row">
					<div class="input-field col s6">
						<i class="material-icons prefix">search</i>
			            <label for="nomepesquisa" class="active">Pesquia por nome:</label>
						<input name="nomepesquisa" id="nomepesquisa" type="text" class="validate" 
							th:value="${nomepesquisa}">
					</div>
					
					<div class="input-field col s3">
						<label for="pesqsituacao" class="active">Pesquisa po situação</label>
						<select class="browser-default" name="pesqsituacao" id="pesqsituacao">
						    <option value="">Todos</option>
						    <option value="Em aberto">Em aberto</option>
						    <option value="Resolvido">Resolvido</option>
						    <option value="Não resolvido">Não resolvido</option>
					  </select>
					</div>
				</div>
				<button class="btn waves-effect waves-light" type="submit" name="action">Pesquisar 
					<i class="material-icons right">search</i>
				</button>
				<a class="btn waves-effect waves-light" href="/listaclientes">Listar
					<i class="material-icons right">list</i>
				</a>
				<button class="btn waves-effect waves-light" type="submit" name="action"
					onclick="document.getElementById('pesquisarcliente').method='get'">Relatório 
					<i class="material-icons right">print</i>
				</button>
				<br><br>
			</form>
		</div>
	</fieldset>
	<br>
	
	<div class="row" sec:authorize="hasRole('ROLE_ADMIN')">
		<div class="col s12">
			<table class="striped">
				<thead>
					<tr>
						<th>Cód</th>
						<th>Nome</th>
						<th>Telefone</th>
						<th>E-mail</th>
						<th>Aparelho</th>
						<th>Situação</th>
						<th>Foto</th>
						<th>Editar</th>
						<th>Excluir</th>
					</tr>
				</thead>
		        <tbody>
		          <tr th:each = "cliente : ${clientes.content}">
		           <td th:text = "${cliente.id}"></td>
					<td><a th:href="@{/detalhecliente/{idcliente}(idcliente=${cliente.id})}" style="color: black;" title="Detalhes"><span th:text = "${cliente.nome}"></span></a></td>
					<td th:text = "${cliente.telefone}"></td>
					<td th:text = "${cliente.email}"></td>
					<td th:text = "${cliente.equipamento}"></td>
<!-- 					<td th:text = "${cliente.foto}"></td> -->
					<td th:text = "${cliente.situacao}"></td>
					<td>
						<a th:if="${cliente.foto != null}" th:href="@{/baixarfoto/{idcliente}(idcliente=${cliente.id})}">Download</a>
						<a th:if="${cliente.foto == null}" style="color: red;">Nada consta</a>
					</td>				
					<td><a th:href="@{/editarcliente/{idcliente}(idcliente=${cliente.id})}">Editar</a></td>
					<td><a th:href="@{/excluircliente/{idcliente}(idcliente=${cliente.id})}">Excluir</a></td>
		          <tr>
		        </tbody>
		      </table>
	      </div>
      </div>
      
	 <footer class="page-footer">
	     <div class="footer-copyright">
	       <div class="container">
	       	© 2020 João Paulo da Mata Mendes
	       </div>
	     </div>
      </footer>
	<!-- Adicionando Javascript -->
    <script>

        $(document).ready(function() {
			
//         	$('#entrada').datepicker({
//         		showOthermonths:false,
//         		format: 'yyyy-mm-dd'
//         	});
        	
            function limpa_formulário_cep() {
                // Limpa valores do formulário de cep.
                $("#rua").val("");
                $("#bairro").val("");
                $("#cidade").val("");
                $("#uf").val("");
                $("#ibge").val("");
            }
            
            //Quando o campo cep perde o foco.
            $("#cep").blur(function() {

                //Nova variável "cep" somente com dígitos.
                var cep = $(this).val().replace(/\D/g, '');

                //Verifica se campo cep possui valor informado.
                if (cep != "") {

                    //Expressão regular para validar o CEP.
                    var validacep = /^[0-9]{8}$/;

                    //Valida o formato do CEP.
                    if(validacep.test(cep)) {

                        //Preenche os campos com "..." enquanto consulta webservice.
                        $("#rua").val("...");
                        $("#bairro").val("...");
                        $("#cidade").val("...");
                        $("#uf").val("...");
                        $("#ibge").val("...");

                        //Consulta o webservice viacep.com.br/
                        $.getJSON("https://viacep.com.br/ws/"+ cep +"/json/?callback=?", function(dados) {

                            if (!("erro" in dados)) {
                                //Atualiza os campos com os valores da consulta.
                                $("#rua").val(dados.logradouro);
                                $("#bairro").val(dados.bairro);
                                $("#cidade").val(dados.localidade);
                                $("#uf").val(dados.uf);
                                $("#ibge").val(dados.ibge);
                            } //end if.
                            else {
                                //CEP pesquisado não foi encontrado.
                                limpa_formulário_cep();
                                alert("CEP não encontrado.");
                            }
                        });
                    } //end if.
                    else {
                        //cep é inválido.
                        limpa_formulário_cep();
                        alert("Formato de CEP inválido.");
                    }
                } //end if.
                else {
                    //cep sem valor, limpa formulário.
                    limpa_formulário_cep();
                }
            });
        });

    </script>
    
    <script type="text/javascript">
    function isNumberKey(evt) {
    	return Number.isInteger(parseInt(evt.key, 10))
    		|| evt.key === 'Delete'
    		|| evt.key === 'Backspace'
    		|| evt.key === 'ArrowLeft'
    		|| evt.key === 'ArrowRight'
    		|| evt.key === 'Tab'
    }
    
    </script>
</body>
</html>